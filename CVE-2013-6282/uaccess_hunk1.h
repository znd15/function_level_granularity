
extern int __put_user_2(void *, unsigned int);
extern int __put_user_4(void *, unsigned int);
extern int __put_user_8(void *, unsigned long long);

#define __put_user_x(__r2,__p,__e,__s) \
 __asm__ __volatile__ ( \
 __asmeq("%0", "r0") __asmeq("%2", "r2") \
		"bl __put_user_" #__s \
 : "=&r" (__e) \
 : "0" (__p), "r" (__r2) \
 : "ip", "lr", "cc")

#define put_user(x,p) \
 ({ \
 register const typeof(*(p)) __r2 asm("r2") = (x); \
 register const typeof(*(p)) __user *__p asm("r0") = (p);\
 register int __e asm("r0"); \
 switch (sizeof(*(__p))) { \
 case 1: \
 __put_user_x(__r2, __p, __e, 1); \
 break; \
 case 2: \
 __put_user_x(__r2, __p, __e, 2); \
 break; \
 case 4: \
 __put_user_x(__r2, __p, __e, 4); \
 break; \
 case 8: \
 __put_user_x(__r2, __p, __e, 8); \
 break; \
 default: __e = __put_user_bad(); break; \
 } \
 __e; \
 }