
extern int __get_user_1(void *);
extern int __get_user_2(void *);
extern int __get_user_4(void *);

#define __get_user_x(__r2,__p,__e,__s,__i...) \
 __asm__ __volatile__ ( \
 __asmeq("%0", "r0") __asmeq("%1", "r2") \
		"bl __get_user_" #__s \
 : "=&r" (__e), "=r" (__r2) \
 : "0" (__p) \
 : __i, "cc")

#define get_user(x,p) \
 ({ \
 register const typeof(*(p)) __user *__p asm("r0") = (p);\
 register unsigned long __r2 asm("r2"); \
 register int __e asm("r0"); \
 switch (sizeof(*(__p))) { \
 case 1: \
 __get_user_x(__r2, __p, __e, 1, "lr"); \
 break; \
 case 2: \
 __get_user_x(__r2, __p, __e, 2, "r3", "lr"); \
 break; \
 case 4: \
 __get_user_x(__r2, __p, __e, 4, "lr"); \
 break; \
 default: __e = __get_user_bad(); break; \
 } \
 x = (typeof(*(p))) __r2; \
 __e; \
 }