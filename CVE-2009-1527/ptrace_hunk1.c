
repeat:
	/*
 * Nasty, nasty.
 *
 * We want to hold both the task-lock and the
 * tasklist_lock for writing at the same time.
 * But that's against the rules (tasklist_lock
 * is taken for reading by interrupts on other
 * cpu's that may have task_lock).
 */
	task_lock(task);
	if (!write_trylock_irqsave(&tasklist_lock, flags)) {
		task_unlock(task);
		do {
			cpu_relax();
		} while (!write_can_lock(&tasklist_lock));
		goto repeat;
	}