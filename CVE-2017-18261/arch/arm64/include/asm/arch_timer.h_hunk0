
DECLARE_PER_CPU(const struct arch_timer_erratum_workaround *,
		timer_unstable_counter_workaround);

#define arch_timer_reg_read_stable(reg) \
({ \
 u64 _val; \
 if (needs_unstable_timer_counter_workaround()) { \
 const struct arch_timer_erratum_workaround *wa; \
 preempt_disable(); \
 wa = __this_cpu_read(timer_unstable_counter_workaround); \
 if (wa && wa->read_##reg) \
 _val = wa->read_##reg(); \
 else \
 _val = read_sysreg(reg); \
 preempt_enable(); \
 } else { \
 _val = read_sysreg(reg); \
 } \
 _val; \
}