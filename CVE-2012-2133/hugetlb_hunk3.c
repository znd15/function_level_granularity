
static void return_unused_surplus_pages(struct hstate *h,
					unsigned long unused_resv_pages)
{
	unsigned long nr_pages;

	/* Uncommit the reservation */
	h->resv_huge_pages -= unused_resv_pages;

	/* Cannot return gigantic pages currently */
	if (h->order >= MAX_ORDER)
		return;

	nr_pages = min(unused_resv_pages, h->surplus_huge_pages);

	/*
 * We want to release as many surplus pages as possible, spread
 * evenly across all nodes with memory. Iterate across these nodes
 * until we can no longer free unreserved surplus pages. This occurs
 * when the nodes with surplus pages have no free pages.
 * free_pool_huge_page() will balance the the freed pages across the
 * on-line nodes with memory and will handle the hstate accounting.
 */
	while (nr_pages--) {
		if (!free_pool_huge_page(h, &node_states[N_HIGH_MEMORY], 1))
			break;
	}
}