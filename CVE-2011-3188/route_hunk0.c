



/*
 * INET An implementation of the TCP/IP protocol suite for the LINUX
 * operating system. INET is implemented using the BSD Socket
 * interface as the means of communication with the user level.
 *
 * ROUTE - implementation of the IP router.
 *
 * Authors: Ross Biro
 * Fred N. van Kempen, <waltje@uWalt.NL.Mugnet.ORG>
 * Alan Cox, <gw4pts@gw4pts.ampr.org>
 * Linus Torvalds, <Linus.Torvalds@helsinki.fi>
 * Alexey Kuznetsov, <kuznet@ms2.inr.ac.ru>
 *
 * Fixes:
 * Alan Cox : Verify area fixes.
 * Alan Cox : cli() protects routing changes
 * Rui Oliveira : ICMP routing table updates
 * (rco@di.uminho.pt) Routing table insertion and update
 * Linus Torvalds : Rewrote bits to be sensible
 * Alan Cox : Added BSD route gw semantics
 * Alan Cox : Super /proc >4K
 * Alan Cox : MTU in route table
 * Alan Cox : MSS actually. Also added the window
 * clamper.
 * Sam Lantinga : Fixed route matching in rt_del()
 * Alan Cox : Routing cache support.
 * Alan Cox : Removed compatibility cruft.
 * Alan Cox : RTF_REJECT support.
 * Alan Cox : TCP irtt support.
 * Jonathan Naylor : Added Metric support.
 * Miquel van Smoorenburg : BSD API fixes.
 * Miquel van Smoorenburg : Metrics.
 * Alan Cox : Use __u32 properly
 * Alan Cox : Aligned routing errors more closely with BSD
 * our system is still very different.
 * Alan Cox : Faster /proc handling
 * Alexey Kuznetsov : Massive rework to support tree based routing,
 * routing caches and better behaviour.
 *
 * Olaf Erb : irtt wasn't being copied right.
 * Bjorn Ekwall : Kerneld route support.
 * Alan Cox : Multicast fixed (I hope)
 * Pavel Krauz : Limited broadcast fixed
 * Mike McLagan : Routing by source
 * Alexey Kuznetsov : End of old history. Split to fib.c and
 * route.c and rewritten from scratch.
 * Andi Kleen : Load-limit warning messages.
 * Vitaly E. Lavrov : Transparent proxy revived after year coma.
 * Vitaly E. Lavrov : Race condition in ip_route_input_slow.
 * Tobias Ringstrom : Uninitialized res.type in ip_route_output_slow.
 * Vladimir V. Ivanov : IP rule info (flowid) is really useful.
 * Marc Boucher : routing by fwmark
 * Robert Olsson : Added rt_cache statistics
 * Arnaldo C. Melo : Convert proc stuff to seq_file
 * Eric Dumazet : hashed spinlocks and rt_check_expire() fixes.
 * Ilia Sotnikov : Ignore TOS on PMTUD and Redirect
 * Ilia Sotnikov : Removed TOS from hash calculations
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version
 * 2 of the License, or (at your option) any later version.
 */

#include <linux/module.h>
#include <asm/uaccess.h>
#include <asm/system.h>
#include <linux/bitops.h>
#include <linux/types.h>
#include <linux/kernel.h>
#include <linux/mm.h>
#include <linux/bootmem.h>
#include <linux/string.h>
#include <linux/socket.h>
#include <linux/sockios.h>
#include <linux/errno.h>
#include <linux/in.h>
#include <linux/inet.h>
#include <linux/netdevice.h>
#include <linux/proc_fs.h>
#include <linux/init.h>
#include <linux/workqueue.h>
#include <linux/skbuff.h>
#include <linux/inetdevice.h>
#include <linux/igmp.h>
#include <linux/pkt_sched.h>
#include <linux/mroute.h>
#include <linux/netfilter_ipv4.h>
#include <linux/random.h>
#include <linux/jhash.h>
#include <linux/rcupdate.h>
#include <linux/times.h>
#include <linux/slab.h>
#include <net/dst.h>
#include <net/net_namespace.h>
#include <net/protocol.h>
#include <net/ip.h>
#include <net/route.h>
#include <net/inetpeer.h>
#include <net/sock.h>
#include <net/ip_fib.h>
#include <net/arp.h>
#include <net/tcp.h>
#include <net/icmp.h>
#include <net/xfrm.h>
#include <net/netevent.h>
#include <net/rtnetlink.h>
#ifdef CONFIG_SYSCTL
#include <linux/sysctl.h>
#endif
#include <net/atmclip.h>

#define RT_FL_TOS(oldflp4) \
 ((u32)(oldflp4->flowi4_tos & (IPTOS_RT_MASK | RTO_ONLINK)))

#define IP_MAX_MTU 0xFFF0

#define RT_GC_TIMEOUT (300*HZ)

static int ip_rt_max_size;
static int ip_rt_gc_timeout __read_mostly	= RT_GC_TIMEOUT;
static int ip_rt_gc_interval __read_mostly	= 60 * HZ;
static int ip_rt_gc_min_interval __read_mostly	= HZ / 2;
static int ip_rt_redirect_number __read_mostly	= 9;
static int ip_rt_redirect_load __read_mostly	= HZ / 50;
static int ip_rt_redirect_silence __read_mostly	= ((HZ / 50) << (9 + 1));
static int ip_rt_error_cost __read_mostly	= HZ;
static int ip_rt_error_burst __read_mostly	= 5 * HZ;
static int ip_rt_gc_elasticity __read_mostly	= 8;
static int ip_rt_mtu_expires __read_mostly	= 10 * 60 * HZ;
static int ip_rt_min_pmtu __read_mostly		= 512 + 20 + 20;
static int ip_rt_min_advmss __read_mostly	= 256;
static int rt_chain_length_max __read_mostly	= 20;

/*
 * Interface to generic destination cache.
 */

static struct dst_entry *ipv4_dst_check(struct dst_entry *dst, u32 cookie);
static unsigned int	 ipv4_default_advmss(const struct dst_entry *dst);
static unsigned int	 ipv4_default_mtu(const struct dst_entry *dst);
static void		 ipv4_dst_destroy(struct dst_entry *dst);
static struct dst_entry *ipv4_negative_advice(struct dst_entry *dst);
static void		 ipv4_link_failure(struct sk_buff *skb);
static void		 ip_rt_update_pmtu(struct dst_entry *dst, u32 mtu);
static int rt_garbage_collect(struct dst_ops *ops);

static void ipv4_dst_ifdown(struct dst_entry *dst, struct net_device *dev,
			    int how)
{
}